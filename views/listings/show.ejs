<!DOCTYPE html>
<% layout("/layouts/boilerplate") %>


    <html lang="en">

    <head>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>
            <%= listing.title %>
        </title>
        <style>
            /* Stylish red delete button */
            .delete {
                background-color: #f06252;
                color: #fff;
                border: none;
                padding: 0.5em 1.2em;
                border-radius: 4px;
                cursor: pointer;
                font-weight: bold;
                transition: background 0.2s;
            }

            .delete:hover {
                background-color: #2b4bc0;
            }

            .delete:hover {
                background-color: #2b4bc0;
            }

            img {
                width: 50vw;
                /* 50% of viewport width */
                height: 50vh;
                /* 50% of viewport height */
            }
        </style>
    </head>

    <body>

        </style>
        </head>

        <body>


            <h3>
                <%= listing.title %>
            </h3>


            <div class="card2 col-6 offset-2">

                <img class="card-img-top show-img" src="<%= listing.image.url %>" alt="Card image cap">
                <div class="card-body">

                    <!-- <b>Title: <%= listing.title %> </b><br> -->
                    Owner :<b ><i><%= listing.owner.username%><i></b>
                        <hr>
                    <%= listing.description %> <br>
                        Price: $<%= listing.price ? listing.price.toLocaleString('en-US') : "N/A" %><br>
                            Location: <%= listing.location %>
                </div>
            </div>

            <% if(currentUser && listing.owner._id.equals(currentUser._id)) { %>
            <div class="ending">

                <a href="/listings/<%= listing._id %>/edit" class="btn btn-dark mb-2">Edit this listing</a>
                <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST">
                    <button class="delete btn btn-warning">Delete post</button>
                </form>
            </div>

            <%}%>


      
           <% if(currentUser) {%>
            <div class="card2 col-6 offset-2">
                <hr>
                <h4>Leave a review Down </h4>
                <form action="/listings/<%= listing._id %>/reviews" method="POST" novalidate class="needs-validation">
                    <!-- Star rating input -->
                    <div class="mb-3">
                        <label class="form-label">Rating</label>
                        <div class="star-rating">
                            <% for(let i=5; i>= 1; i--) { %>
                                <input type="radio" id="star<%= i %>" name="review[rating]" value="<%= i %>" required>
                                <label for="star<%= i %>">
                                    <i class="fa fa-star"></i>
                                </label>
                                <% } %>
                        </div>
                    </div>

                    <div>
                        <label for="comment">Comments</label>
                        <textarea name="review[comment]" id="comment" required cols="25" rows="6"
                            class="form-control"></textarea>
                        <div class="invalid-feedback">Please Comment is required</div>
                    </div>

                    <button class="btn btn-outline-dark mt-2 ">Submit</button>
                </form>
            <%}%>
                <hr>
                
                 
                <h4>Reviews</h4>
                <div class="row">
                    <% for (let review of listing.reviews) { %>
                        <div class="col-md-6 mb-1">
                            <div class="card shadow-sm">
                                <div class="card-body card-review">

                                    <% for(let i=1; i <=5; i++) { %>
                                        <% if(i <=review.rating) { %>
                                            <i class="fa-solid fa-star text-warning"></i>
                                            <% } else { %>
                                                <i class="fa-regular fa-star text-warning"></i>
                                                <% } %>
                                                    <% } %>

                                                        <p class="card-text">
                                                            <%= review.comment %>
                                                        </p>
                                                        <small class="text-muted">
                                                         by <%= review.author ? review.author.username : "Unknown" %>
      </small>
                                                        <form
                                                            action="/listings/<%= listing._id %>/reviews/<%= review._id %>/delete?_method=DELETE"
                                                            method="POST" class="mt-2"  >
                                                            <button class="btn btn-danger btn-sm mb-1 ">Delete Review</button>
                                                        </form>
                                </div>
                            </div>
                        </div>
                        <% } %>
                </div>

            </div>
        </body>

    </html>